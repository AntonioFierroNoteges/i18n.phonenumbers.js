<!DOCTYPE html>
<head>
  <title>Phone number parser demo</title>
  <script src="../i18n.phonenumbers.min.js"></script>
</head>
<html>
  <body>

  <h2>Phone number parser demo</h2>

  <form>
    <p>
      <label>Specify a phone number
        <br/><input type="text" name="phoneNumber" id="phoneNumber" size="25" />
      </label>
    </p>
    <p>
      <label>Specify a default country (ISO 3166-1 two-letter country code)
        <br/><input type="text" name="defaultCountry" id="defaultCountry" size="2" />
      </label>
    </p>
    <p>
      <label>Specify a carrier code (optional, only valid for some countries)
        <br/><input type="text" name="carrierCode" id="carrierCode" size="2" />
      </label>
    </p>
    <input type="button" value="Submit" onclick="return parser();" />
    <input type="reset" value="Reset" />
    <p>
      <label>Results
        <br/><textarea id="output" rows="20" cols="100"></textarea>
      </label>
    </p>
  </form>

  <script type="text/javascript">
    Object.prototype.getKeyByValue = function(value) {
      for (var prop in this) {
        if (this.hasOwnProperty(prop)) {
          if (this[ prop ] === value)
            return prop;
        }
      }
    };
    var textArea = document.getElementById('output'),
        phoneNumber = document.getElementById('phoneNumber'),
        defaultCountry = document.getElementById('defaultCountry'),
        carrierCode = document.getElementById('carrierCode'),
        getInputValues = function() {
          return {
            number: phoneNumber.value || null,
            country: defaultCountry.value || null,
            carrier: carrierCode.value || null
          };
        },
        output = '',
        setOutput = function(output) {
          textArea.value = output;
        };
    //
    function parser() {
      var inValues = getInputValues(),
          number = inValues.number,
          defaultRegionCode = inValues.country,
          carrier = inValues.carrier,
          isPossible = false,
          regionCode = null,
          isValid = false;
      output = '';
      setOutput(output);

      try {
        output += '\nValidation Results:';
        isPossible = leodido.i18n.PhoneNumbers.isPossibleNumber(number); // FIXME: pass country?
        output += '\n* isPossibleNumber(\'' + number + '\') -> ';
        output += isPossible ? 'true' : 'false';
        if (!isPossible) {
          // Number not possible
          output += '\n* isPossibleNumberWithReason(\'' + number + '\') -> ';
          var PNV = leodido.i18n.PhoneNumbers.RESULT,
              PNE = leodido.i18n.PhoneNumbers.ERROR,
              reason = leodido.i18n.PhoneNumbers.isPossibleNumberWithReason(number),
              code = PNV.getKeyByValue(reason);
          output += code;
          if (typeof PNE[code] !== 'undefined') {
            // PNV.INVALID_COUNTRY_CODE || PNV.TOO_LONG
            output += '\nERR: ' + PNE[code];
          } else {
            // NOTE: validation RESULT has only TOO_SHORT code while ERROR has two type of TOO_SHORT errors
            if (code.match(/TOO_SHORT/)) {
              // PNV.TOO_SHORT
              output += '\nERR: ' + PNE.TOO_SHORT_AFTER_IDD;
              output += '\nERR: ' + PNE.TOO_SHORT_NSN;
            } else {
              // NOTE: should never happen that reason == PNV.IS_POSSIBLE
              // PNV.IS_POSSIBLE || PNE.NOT_A NUMBER
              if (reason === PNV.IS_POSSIBLE) {
                output += '\nERR: something wrong, should never happen that number IS_POSSIBLE at this stage';
              } else {
                output += '\nERR: probably an unknown error (code: ' + code + ')';
              }
            }
          }
        }
      } catch (exc) {
        output += '\nEXC: ' + exc + ' [from isPossibleNumber()]';
      }

      if (isPossible) {
        try {
          //  Number possible, check if it is valid
          isValid = leodido.i18n.PhoneNumbers.isValidNumber(number, defaultRegionCode);
          console.log(isValid, defaultRegionCode, leodido.i18n.PhoneNumbers.getRegionCodeForNumber(number));
        } catch (exc) {
          output += '\nEXC: ' + exc + ' [from isValidNumber()]';
        }
      }


      setOutput(output);
      return false;
    }
  </script>

  </body>
</html>
